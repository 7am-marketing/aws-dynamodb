<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Amazon DynamoDB nodejs module</title>
  
  
  
	<style>

	</style>
  
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Aws-dynamodb</h1>
		<p><a href="https://www.npmjs.com/package/aws-dynamodb"><img src="https://nodei.co/npm/aws-dynamodb.png?downloads=true" alt="npm page"></a></p>
        <a href="https://github.com/databank/aws-dynamodb" class="button"><small>View project on</small> GitHub</a>
		
          <a href="https://github.com/databank/aws-dynamodb/zipball/master" class="button" style="top: 90px;background: transparent url(../images/download-button.png) 0 0 no-repeat;">
            <small>Download</small>
            .zip file
          </a>
		
		
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          
          
		  
		  

<h1>
<a id="aws-dynamodb" class="anchor" href="#aws-dynamodb" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wrapper around aws-sdk for nodejs to simplify working with DynamoDB</h1>

<a name="installation"></a>
<p><strong>Installation</strong></p>

<pre class="command-line">
<span class="command">npm install aws-dynamodb</span>

<span class="comment">// check for new versions</span>
<span class="command">npm outdated</span>

<span class="comment">// upgrade if necessary</span>
<span class="command">npm update aws-dynamodb</span>
</pre>

<a name="testing"></a>
<p><strong>Testing</strong></p>
<pre class="command-line">
<span class="comment">// add AWS credentials to your environment first</span>
<span class="command">source test/credentials</span>

<span class="comment">// run the tests</span>
<span class="command">npm test</span>
</pre>











<a name="initialization"></a>
<p><strong>Initialization</strong></p>
<pre class="command-line code">
var $credentials = {
    "accessKeyId": "XXXXXXXXXXXXXXXX", 
    "secretAccessKey": "ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ", 
    "region": "eu-west-1"
}
var DynamoDB = require('aws-dynamodb')($credentials)
</pre>


<a name="rawcalls"></a>
<p><strong>Doing raw calls to aws-sdk</strong></p>
<pre class="command-line code">
DynamoDB.client.listTables(function(err, data) {
    console.log(data.TableNames);
});
console.log( DynamoDB.client )
</pre>



<a name="errorfeed"></a>
<p><strong>Global error feed</strong></p>
<pre class="command-line code">
<span class="comment">// every call to Amazon DynamoDB that fail will</span>
<span class="comment">// call this function before the operation's callback</span>
DynamoDB.on('error', function( operation, error, payload ) {
    <span class="comment">// you could use this to log fails into LogWatch for </span>
    <span class="comment">// later analysis or SQS queue lazy processing</span>
})
</pre>


<a name="insert"></a>
<p><strong>Insert Item</strong> ( does not replace existing items )</p>
<pre class="command-line code">
DynamoDB
    .table('users')
    .insert({
        email: 'test@test.com',
        password: 'qwert',
        created_at: new Date().getTime(),
        updated_at: null
    }, function(err,data) {
        console.log( err, data )
    })

DynamoDB
    .table('messages')
    .insert({
        to: 'test@test.com',
        date: new Date().getTime(),
        subject: 'Foo',
        message: 'Bar'
    })

<span class="comment">// insert item with nested attributes</span>
<span class="comment">// carefull though as foo.bar domain actually exist :)</span>
DynamoDB
    .table('messages')
    .insert({
        to: 'test@test.com',
        date: new Date().getTime(),
        boolean_true: true,
        boolean_false: false,
        key_null: null,
        string: "string",
        number: 1,
        array_empty: [],
        array_strings: ['alfa','beta','gama'],
        array_numbers: [7,9,15],
        array_mixed: [null, "string", 5, true, false, { key: "value"}, ["nested","array"] ],
        nested_object: {
            name: "Foo",
            email: "baz@foo.bar",
            nested_attribute: {
                boolean_value: true,
                null_key: null,
                some_string: "tadaa",
                lucky_number: 12
            }
        }
    })
</pre>


<a name="update"></a>
<p><strong>Update Item</strong> ( does not create the item if item does not exist )</p>
<pre class="command-line code">
<span class="comment">// update multiple attributes in a HASH table</span>
DynamoDB
	.table('users')
	.where('email').eq('test@test.com')
	.update({
		password: 'qwert', 
		firstname: 'Smith'
	}, function( err, data ) {
		console.log( err, data )
	})

<span class="comment">// update 1 attribute in a HASH-RANGE table</span>
DynamoDB
	.table('messages')
	.where('to').eq('user1@test.com')
	.where('date').eq( 1375538399 )
	.update({
		seen: true
	}, function( err, data ) {
		console.log( err, data )
	})
</pre>

<a name="replace"></a>
<p><strong>Replace Item</strong> ( does not create the item if item does not exist )</p>
<pre class="command-line code">
<span class="comment">// completely replaces the item, new item will only contain specified attributes </span>
DynamoDB
    .table('users')
    .replace({
        email: 'test@test.com',
        password: 'qwert',
        created_at: new Date().getTime()
    }, function(err,data) {
        console.log( err, data )
    })
</pre>

<a name="insertorupdate"></a>
<p><strong>Insert on Duplicate Key Update</strong> ( in 1 request to DynamoDB )</p>
<pre class="command-line code">
DynamoDB
    .table('users')
    .where('email').eq('test@test.com')
    .insert_or_update({
        password: 'qwert', 
        firstname: 'Smith'
    }, function( err, data ) {
        console.log( err, data )
    })
</pre>

<a name="increment"></a>
<p><strong>Increment Item's Attribute(s)</strong> ( does not create the item if item does not exist )</p>
<pre class="command-line code">
<span class="comment">// increment 1 attribute in a HASH table </span>
DynamoDB
    .table('users')
    .where('email').eq('test@test.com')
    .increment({
        login_count: 1
    }, function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// increment multiple attributes in a HASH-RANGE table</span>
DynamoDB
    .table('statistics')
    .where('domain').eq('mydomain.com')
    .where('day').eq('2013-11-01')
    .increment({
        visitors: 1,
        page_views 5,
        unique_page_views: 1
    }, function( err, data ) {
        console.log( err, data )
    })
</pre>

<a name="deleteattributes"></a>
<p><strong>Delete Item's Attribute(s)</strong></p>
<pre class="command-line code">
DynamoDB
	.table('messages')
	.where('to').eq('user1@test.com')
	.where('date').eq( 1375538399 )
	.delete(['seen','subject'], function( err, data ) {
		console.log( err, data )
	})
</pre>

<a name="deleteitem"></a>
<p><strong>Delete Item</strong></p>
<pre class="command-line code">
<span class="comment">// delete an item from a HASH table</span>
DynamoDB
    .table('users')
    .where('email').eq( 'test@test.com' )
    .delete(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// delete an item from a HASH-RANGE table</span>
DynamoDB
    .table('messages')
    .where('to').eq( 'user1@test.com' )
    .where('date').eq( 1375538399 )
    .delete(function( err, data ) {
        console.log( err, data )
    })
</pre>

<a name="get"></a>
<p><strong>Get Item</strong></p>
<pre class="command-line code">
<span class="comment">// getting an item with HASH key only</span>
DynamoDB
    .table('users')
    .where('email').eq('test@test.com')
    .get(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// getting an item from a HASH-RANGE table, with consistent read</span>
DynamoDB
    .table('messages')
    .where('to').eq('user1@test.com')
    .where('date').eq( 1375538399 )
    .consistent_read()
    .get(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// specifying what attributes to return</span>
DynamoDB
    .table('users')
    .select('email','registered_at')
    .where('email').eq( 'test@test.com' )
    .get(function( err, data ) {
        console.log( err, data )
    })
</pre>

<a name="query"></a>
<p><strong>Query</strong> ( not possible on HASH only tables )</p>
<pre class="command-line code">
<span class="comment">// for hash key comparson operator is always eq()</span>
<span class="comment">// for range key you can specify: le() , lt() , ge() , gt() , begins_with() , between(a,b)</span>

<span class="comment">// base query, return 10 records with consistent read</span>
DynamoDB
    .table('statistics')
    .where('domain').eq('mydomain.com')
    .limit(10)
    .consistent_read()
    .query(function(err, data ) {
        console.log(err,data)
    })

<span class="comment">// only return specified fields, in descending order</span>
DynamoDB
    .table('statistics')
    .select('unique_visitors','unique_pageviews')
    .where('domain').eq('mydomain.com')
    .where('day').ge('2013-11-01')
    .descending()
    .query(function( err, data ) {
        console.log( err, data )
    })
</pre>

<a name="queryindex"></a>
<p><strong>Query an Index with order_by()</strong></p>
<pre class="command-line code">
<span class="comment">// suppose you have an index on messages called starredIndex</span>
<span class="comment">// and you want to retrieve only the messages that are starred</span>

DynamoDB
    .table('messages')
    .where('to').eq('user1@test.com')
    .order_by('starredIndex')
    .descending()
    .query(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// return all attributes including non-projected ( LSI only )</span>
DynamoDB
    .table('messages')
    .select( DynamoDB.ALL )
    .where('to').eq('user1@test.com')
    .order_by('starredIndex')
    .descending()
    .query(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// NOTE: specifying non-projected fields in select() will:</span>
<span class="comment">// * cost you extra reads on a LSI index</span>
<span class="comment">// * not be returned on a GSI index</span>
</pre>


<a name="queryfilter"></a>
<p><strong>Query filtering</strong></p>
<pre class="command-line code">
<span class="comment">// A filter lets you apply conditions to the data after query</span>
<span class="comment">// Only the items that meet your conditions are returned</span>
<span class="comment">// All the conditions must evaluate to true ( conditions are ANDed together )</span>
<span class="comment">// Comparison operators: eq(), le() , lt() , ge() , gt() , begins_with() , between(a,b)</span>
DynamoDB
    .table('messages')
    .where('to').eq('user1@test.com')
    .having('one_attribute').between(100,200)
    .having('other_attribute').eq(true)
    .query(function( err, data ) {
        console.log( err, data )
    })
</pre>



<a name="querycontinue"></a>
<p><strong>Query continue from last item</strong></p>
<pre class="command-line code">
<span class="comment">// query a table until the end of results :)</span>
(function recursive_call( $lastKey ) {
    DynamoDB
        .table('messages')
        .where('to').eq('user1@test.com')
        .resume($lastKey)
        .query(function( err, data ) {
            <span class="comment">// handle error, process data ...</span>

            if (this.LastEvaluatedKey === null) {
                <span class="comment">// reached end, do a callback() maybe</span>
                return
            } 

            var $this = this
            setTimeout(function() {
                recursive_call($this.LastEvaluatedKey)
            },1000)

        })
})(null)    
</pre>



<a name="scan"></a>
<p><strong>Full table scan</strong> </p>
<pre class="command-line code">
<span class="comment">// optionally you can limit the returned attributes with .select()</span>
<span class="comment">// and the number of results with .limit()</span>

DynamoDB
    .table('messages')
    .select('from','subject')
    .having('somkey').eq('somevalue')
    .limit(10)
    .scan(function( err, data ) {
        console.log( err, data )
    })

<span class="comment">// continous scan until end of table</span>

(function recursive_call( $lastKey ) {
    DynamoDB
        .table('messages')
        .resume($lastKey)
        .scan(function( err, data ) {
            <span class="comment">// handle error, process data ...</span>

            if (this.LastEvaluatedKey === null) {
                <span class="comment">// reached end, do a callback() maybe</span>
                return
            } 

            var $this = this
            setTimeout(function() {
                recursive_call($this.LastEvaluatedKey)
            },1000)

        })
})(null) 
</pre>





<a name="scanindex"></a>
<p><strong>GSI scan</strong> </p>
<pre class="command-line code">
DynamoDB
    .table('messages')
    .index('GSI_Index_Name')
    .scan(function( err, data ) {
        console.log( err, data )
    })
</pre>




<h1>
<a id="tables-referenced-in-the-samples" class="anchor" href="#tables-referenced-in-the-samples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tables referenced in the samples</h1>

<p>Table <strong>users</strong> with HASH key only </p>

<table>
<thead>
<tr>
<th>email <code>hash</code>
</th>
<th>password</th>
<th>created_at</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="mailto:test@test.com">test@test.com</a></strong></td>
<td>test123</td>
<td><em>1375538399</em></td>
</tr>
</tbody>
</table>

<p>Table <strong>messages</strong> with HASH and RANGE (int) key</p>

<p>to <code>hash</code> | date <code>range</code> | from | subject | message_body | starred
--- | --- | --- | --- | ---
<strong><a href="mailto:user1@test.com">user1@test.com</a></strong> | <strong>1375538399</strong> | <a href="mailto:user2@test.com">user2@test.com</a> | Hello User1 | Goodbye User1 | 1
<strong><a href="mailto:user2@test.com">user2@test.com</a></strong> | <strong>1384167887</strong> | <a href="mailto:somebody@otherdomain.com">somebody@otherdomain.com</a> | Foo | Bar |</p>

<p>Table <strong>statistics</strong> with HASH and RANGE (string) key</p>

<table>
<thead>
<tr>
<th>site <code>hash</code>
</th>
<th>day <code>range</code>
</th>
<th>visitors</th>
<th>unique_visitors</th>
<th>pageviews</th>
<th>unique_pageviews</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>mydomain.com</strong></td>
<td><strong>2013-11-01 21:00:00</strong></td>
<td>100</td>
<td>50</td>
<td>200</td>
<td>150</td>
</tr>
<tr>
<td><strong>mydomain.com</strong></td>
<td><strong>2013-11-01 23:00:00</strong></td>
<td>90</td>
<td>40</td>
<td>100</td>
<td>95</td>
</tr>
</tbody>
</table>
        </section>

        <aside id="sidebar">
			<ul>
				<li><a href="#installation">Installation</a>
				<li><a href="#testing">Testing</a>
				<li><a href="#intitialization">Initialization</a>
				<li><a href="#rawcalls">Raw Calls</a>
				<li><a href="#errorfeed">Error Feed</a>
				<li><a href="#insert">Insert</a>
				<li><a href="#update">Update</a>
				<li><a href="#replace">Replace (no insert)</a>
				<li><a href="#insertorupdate">Insert or Update</a>
				<li><a href="#increment">Increment (no insert)</a>
				<li><a href="#deleteattributes">Delete Attributes</a>
				<li><a href="#deleteitem">Delete Item</a>
				<li><a href="#get">Get Item</a>
				<li><a href="#query">Query</a>
				<li><a href="#queryindex">Query Index</a>
				<li><a href="#queryfilter">Query Filter</a>
				<li><a href="#querycontinue">Query Resume</a>
				<li><a href="#scan">Scan</a>
				<li><a href="#scanindex">Scan Index</a>
          

        </aside>
      </div>
    </div>

<!-- Begin Keptify Tracking -->
<script type='text/javascript'>
(function() {
    var s = document.createElement('script'); s.type = 'text/javascript';
    s.async = true;
    s.src = '//app.keptify.com/5513fca556d23?1';
    var x = document.getElementsByTagName('script')[0];
    x.parentNode.insertBefore(s, x);
})();
</script>
<!-- End Keptify Tracking -->

  </body>
</html>
